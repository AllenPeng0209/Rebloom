# Rebloom Backend API Documentation\n\n## Overview\n\nThe Rebloom Backend API provides secure, HIPAA-compliant services for mental health AI applications. This API handles crisis detection, emergency services integration, end-to-end encryption, offline synchronization, and compliance auditing.\n\n**Base URL**: `https://api.rebloom.app`  \n**Version**: v1  \n**Environment**: Production\n\n## Authentication\n\nAll API endpoints require authentication via JWT tokens or API keys.\n\n### Headers\n```\nAuthorization: Bearer <jwt_token>\nContent-Type: application/json\nX-User-ID: <user_id> (required for user-specific operations)\nX-Session-ID: <session_id> (optional, for session tracking)\n```\n\n## Rate Limiting\n\n- **Rate Limit**: 100 requests per 15-minute window\n- **Crisis Endpoints**: Higher limits (500 requests per 15 minutes)\n- **Headers**: `X-RateLimit-Limit`, `X-RateLimit-Remaining`, `X-RateLimit-Reset`\n\n## Response Format\n\nAll responses follow a consistent format:\n\n```json\n{\n  \"success\": boolean,\n  \"data\": object | array,\n  \"error\": string (only on failure),\n  \"timestamp\": \"2025-08-23T18:00:00Z\",\n  \"requestId\": \"uuid\"\n}\n```\n\n## Crisis Detection API\n\n### Analyze Message for Crisis Risk\n\n**POST** `/api/v1/crisis/analyze`\n\nAnalyzes text content for crisis indicators and provides risk assessment.\n\n**Request Body:**\n```json\n{\n  \"message\": \"I feel like I can't go on anymore\",\n  \"userId\": \"user-123\",\n  \"sessionId\": \"session-456\",\n  \"messageId\": \"msg-789\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"id\": \"assessment-123\",\n    \"userId\": \"user-123\",\n    \"messageId\": \"msg-789\",\n    \"riskLevel\": \"high\",\n    \"confidence\": 0.85,\n    \"triggers\": [\"hopelessness\", \"despair\"],\n    \"recommendedActions\": [\"professional_alert\", \"crisis_resources\"],\n    \"timeToIntervention\": 300,\n    \"assessment\": \"High-risk situation detected based on hopelessness indicators\",\n    \"timestamp\": \"2025-08-23T18:00:00Z\"\n  }\n}\n```\n\n**Risk Levels:**\n- `critical`: Immediate intervention required (< 5 minutes)\n- `high`: Urgent attention needed (< 30 minutes)\n- `medium`: Follow-up recommended (< 24 hours)\n- `low`: Normal monitoring\n\n## Emergency Services API\n\n### Contact Emergency Services\n\n**POST** `/api/v1/emergency/contact`\n\nContacts appropriate emergency services based on user location and crisis type.\n\n**Request Body:**\n```json\n{\n  \"userId\": \"user-123\",\n  \"emergencyType\": \"mental_health_crisis\"\n}\n```\n\n**Emergency Types:**\n- `suicide_attempt`\n- `self_harm`\n- `medical_emergency`\n- `mental_health_crisis`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"success\": true,\n    \"contactedServices\": [\"911\", \"crisis_hotline\"],\n    \"referenceNumber\": \"REF-12345\",\n    \"estimatedResponseTime\": 300,\n    \"alternatives\": []\n  }\n}\n```\n\n### Connect to Crisis Hotline\n\n**POST** `/api/v1/crisis/hotline`\n\nConnects user to appropriate crisis hotline based on location and language preferences.\n\n**Request Body:**\n```json\n{\n  \"userId\": \"user-123\",\n  \"location\": {\n    \"latitude\": 37.7749,\n    \"longitude\": -122.4194,\n    \"city\": \"San Francisco\",\n    \"state\": \"CA\",\n    \"country\": \"US\"\n  },\n  \"preferredLanguage\": \"en\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"success\": true,\n    \"hotline\": {\n      \"id\": \"nsp\",\n      \"name\": \"National Suicide Prevention Lifeline\",\n      \"phone\": \"988\",\n      \"available24h\": true,\n      \"languages\": [\"en\", \"es\"],\n      \"averageWaitTime\": 30\n    },\n    \"connectionDetails\": {\n      \"phone\": \"988\",\n      \"name\": \"National Suicide Prevention Lifeline\",\n      \"estimatedWaitTime\": 30\n    }\n  }\n}\n```\n\n### Create Safety Plan\n\n**POST** `/api/v1/safety/plan`\n\nCreates a personalized safety plan based on crisis assessment.\n\n**Request Body:**\n```json\n{\n  \"userId\": \"user-123\",\n  \"assessment\": {\n    \"riskLevel\": \"high\",\n    \"triggers\": [\"isolation\", \"stress\"],\n    \"confidence\": 0.8\n  },\n  \"existingPlan\": null\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"id\": \"plan-123\",\n    \"userId\": \"user-123\",\n    \"copingStrategies\": [\n      \"Deep breathing exercises (4-7-8 technique)\",\n      \"Call a trusted friend or family member\"\n    ],\n    \"socialSupports\": [\n      {\n        \"name\": \"John Doe\",\n        \"relationship\": \"friend\",\n        \"phone\": \"+1-555-0123\"\n      }\n    ],\n    \"crisisContacts\": [\n      {\n        \"name\": \"National Suicide Prevention Lifeline\",\n        \"phone\": \"988\"\n      }\n    ],\n    \"followUpPlan\": {\n      \"immediateFollowUp\": \"2025-08-24T18:00:00Z\",\n      \"professionalFollowUp\": \"2025-08-30T18:00:00Z\"\n    }\n  }\n}\n```\n\n## Offline Sync API\n\n### Queue Sync Operation\n\n**POST** `/api/v1/sync/queue`\n\nQueues data operations for offline synchronization.\n\n**Request Body:**\n```json\n{\n  \"userId\": \"user-123\",\n  \"operation\": \"create\",\n  \"table\": \"messages\",\n  \"localId\": \"local-msg-123\",\n  \"data\": {\n    \"content\": \"encrypted_message_content\",\n    \"senderType\": \"user\",\n    \"timestamp\": \"2025-08-23T18:00:00Z\"\n  },\n  \"priority\": 1\n}\n```\n\n**Operations:**\n- `create`: Create new record\n- `update`: Update existing record\n- `delete`: Delete record\n\n**Priority Levels:**\n- `1-2`: High priority (immediate sync)\n- `3-5`: Medium priority (standard sync)\n- `6-10`: Low priority (background sync)\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"operationId\": \"op-123\"\n  }\n}\n```\n\n### Get Sync Status\n\n**GET** `/api/v1/sync/status/:userId`\n\nRetrieves synchronization status for a user.\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"isOnline\": true,\n    \"pendingOperations\": 5,\n    \"lastSyncAt\": \"2025-08-23T17:55:00Z\",\n    \"syncInProgress\": false,\n    \"conflicts\": 0\n  }\n}\n```\n\n### Force Sync\n\n**POST** `/api/v1/sync/force`\n\nForces immediate synchronization of pending operations.\n\n**Request Body:**\n```json\n{\n  \"userId\": \"user-123\",\n  \"highPriorityOnly\": false\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"success\": true,\n    \"operations\": {\n      \"total\": 10,\n      \"successful\": 9,\n      \"failed\": 0,\n      \"conflicts\": 1\n    },\n    \"conflicts\": [\n      {\n        \"strategy\": \"merge\",\n        \"resolvedData\": {},\n        \"metadata\": {\n          \"conflictType\": \"update_conflict\",\n          \"resolvedAt\": \"2025-08-23T18:00:00Z\"\n        }\n      }\n    ],\n    \"performance\": {\n      \"duration\": 1500,\n      \"throughput\": 6.67\n    }\n  }\n}\n```\n\n## Encryption API\n\n### Encrypt PHI Data\n\n**POST** `/api/v1/encrypt/phi`\n\nEncrypts Protected Health Information using client-side encryption.\n\n**Request Body:**\n```json\n{\n  \"data\": \"sensitive health information\",\n  \"userId\": \"user-123\",\n  \"userKey\": \"user_encryption_key\",\n  \"dataType\": \"message\"\n}\n```\n\n**Data Types:**\n- `message`: Chat messages\n- `mood`: Mood entries\n- `notes`: Personal notes\n- `profile`: Profile information\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"data\": [1, 2, 3, 4, 5],\n    \"iv\": [6, 7, 8, 9, 10],\n    \"version\": \"v1\",\n    \"timestamp\": 1692811200000\n  }\n}\n```\n\n## Audit & Compliance API\n\n### Search Audit Logs\n\n**GET** `/api/v1/audit/logs`\n\nSearches audit logs with filtering capabilities.\n\n**Query Parameters:**\n- `userId`: Filter by user ID\n- `eventType`: Filter by event type\n- `startDate`: Start date (ISO 8601)\n- `endDate`: End date (ISO 8601)\n- `riskLevel`: Filter by risk level\n- `phiAccessed`: Filter PHI access events (true/false)\n- `limit`: Number of results (default: 50, max: 1000)\n- `offset`: Pagination offset\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": [\n    {\n      \"id\": \"audit-123\",\n      \"eventType\": \"data_access\",\n      \"eventCategory\": \"privacy\",\n      \"severity\": \"info\",\n      \"userId\": \"user-123\",\n      \"resourceType\": \"messages\",\n      \"phiAccessed\": true,\n      \"actionPerformed\": \"decrypt_phi_analysis\",\n      \"eventTimestamp\": \"2025-08-23T18:00:00Z\",\n      \"riskLevel\": \"low\",\n      \"hipaaRelevant\": true\n    }\n  ],\n  \"pagination\": {\n    \"total\": 150,\n    \"limit\": 50,\n    \"offset\": 0,\n    \"hasMore\": true\n  }\n}\n```\n\n### Generate Compliance Report\n\n**POST** `/api/v1/compliance/report`\n\nGenerates comprehensive compliance reports for HIPAA, GDPR, or security audits.\n\n**Request Body:**\n```json\n{\n  \"startDate\": \"2025-08-01T00:00:00Z\",\n  \"endDate\": \"2025-08-31T23:59:59Z\",\n  \"reportType\": \"hipaa\"\n}\n```\n\n**Report Types:**\n- `hipaa`: HIPAA compliance report\n- `gdpr`: GDPR compliance report\n- `security`: Security audit report\n- `full`: Comprehensive report\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"reportType\": \"hipaa\",\n    \"period\": {\n      \"startDate\": \"2025-08-01T00:00:00Z\",\n      \"endDate\": \"2025-08-31T23:59:59Z\"\n    },\n    \"summary\": {\n      \"totalEvents\": 1250,\n      \"phiAccessEvents\": 850,\n      \"securityEvents\": 45,\n      \"crisisEvents\": 12,\n      \"failedAccessAttempts\": 8\n    },\n    \"complianceMetrics\": {\n      \"auditTrailCompleteness\": 0.98,\n      \"dataRetentionCompliance\": 0.95,\n      \"accessControlCompliance\": 0.99\n    }\n  }\n}\n```\n\n## Health Check Endpoints\n\n### Health Check\n\n**GET** `/health`\n\nReturns overall system health status.\n\n**Response:**\n```json\n{\n  \"status\": \"healthy\",\n  \"timestamp\": \"2025-08-23T18:00:00Z\",\n  \"version\": \"1.0.0\",\n  \"environment\": \"production\",\n  \"services\": {\n    \"supabase\": {\n      \"healthy\": true,\n      \"latency\": 45\n    },\n    \"encryption\": {\n      \"healthy\": true,\n      \"message\": \"Encryption service operational\"\n    },\n    \"ai\": {\n      \"healthy\": true,\n      \"message\": \"AI service configured\"\n    }\n  },\n  \"uptime\": 86400,\n  \"memory\": {\n    \"rss\": 52428800,\n    \"heapTotal\": 29360128,\n    \"heapUsed\": 20054144\n  }\n}\n```\n\n### Readiness Check\n\n**GET** `/ready`\n\nReturns service readiness status for load balancers.\n\n**Response:**\n```json\n{\n  \"status\": \"ready\",\n  \"timestamp\": \"2025-08-23T18:00:00Z\"\n}\n```\n\n## Error Handling\n\n### Error Response Format\n\n```json\n{\n  \"success\": false,\n  \"error\": \"Error description\",\n  \"code\": \"ERROR_CODE\",\n  \"timestamp\": \"2025-08-23T18:00:00Z\",\n  \"requestId\": \"req-123\"\n}\n```\n\n### Common Error Codes\n\n- `400`: Bad Request - Invalid input parameters\n- `401`: Unauthorized - Invalid or missing authentication\n- `403`: Forbidden - Insufficient permissions\n- `404`: Not Found - Resource does not exist\n- `429`: Too Many Requests - Rate limit exceeded\n- `500`: Internal Server Error - Server-side error\n- `503`: Service Unavailable - Service temporarily unavailable\n\n### Crisis-Specific Error Handling\n\nFor crisis-related endpoints, errors are handled with special care:\n- Fallback responses are provided when AI analysis fails\n- Conservative risk assessments are returned on uncertainty\n- Alternative resources are always provided\n- Manual review processes are triggered for critical failures\n\n## Security Considerations\n\n### Data Protection\n- All PHI is encrypted client-side before transmission\n- TLS 1.3 encryption for all API communications\n- HIPAA-compliant audit logging for all data access\n- Zero-knowledge architecture where possible\n\n### Access Control\n- JWT-based authentication with short expiration times\n- Role-based access control (RBAC)\n- IP allowlisting for administrative functions\n- Multi-factor authentication for sensitive operations\n\n### Compliance\n- HIPAA compliance for all PHI handling\n- GDPR compliance for EU users\n- SOC 2 Type II certification\n- Regular security audits and penetration testing\n\n## SDK and Integration\n\n### JavaScript/TypeScript SDK\n\n```bash\nnpm install @rebloom/sdk\n```\n\n```typescript\nimport { RebloomClient } from '@rebloom/sdk'\n\nconst client = new RebloomClient({\n  apiKey: 'your-api-key',\n  baseUrl: 'https://api.rebloom.app',\n  userId: 'user-123'\n})\n\n// Analyze message for crisis risk\nconst assessment = await client.crisis.analyze({\n  message: 'I feel overwhelmed',\n  sessionId: 'session-123'\n})\n\n// Queue offline sync operation\nawait client.sync.queue({\n  operation: 'create',\n  table: 'messages',\n  localId: 'local-123',\n  data: { content: 'Hello' }\n})\n```\n\n## Support and Contact\n\n- **Documentation**: https://docs.rebloom.app\n- **Status Page**: https://status.rebloom.app\n- **Support Email**: support@rebloom.app\n- **Emergency Contact**: crisis@rebloom.app\n- **Security Issues**: security@rebloom.app\n\n---\n\n*Last Updated: August 23, 2025*  \n*API Version: 1.0.0*"