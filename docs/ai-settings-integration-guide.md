# AI設定完整功能整合指南

## 🎯 功能概述

本系統實現了完整的AI設定到對話交互的整合，讓用戶可以個性化他們的AI心理健康伴侶。

## 🏗️ 架構組成

### 1. AI設定上下文管理 (`src/contexts/AISettingsContext.tsx`)

**功能特點：**
- 統一管理所有AI設定狀態
- 自動持久化設定到本地存儲
- 提供動態生成系統提示詞的功能
- 支持設定重置和更新

**核心方法：**
```typescript
// 更新特定設定
updateSettings(newSettings: Partial<AISettings>)

// 保存完整設定
saveSettings(settings: AISettings)

// 重置為預設值
resetSettings()

// 生成個性化系統提示詞
generateSystemPrompt(): string
```

### 2. AI設定介面 (`app/profile/ai-settings.tsx`)

**更新內容：**
- 整合AISettingsContext，實現真實的狀態管理
- 添加保存成功/失敗的用戶反饋
- 實現重置功能，包含確認對話框
- 改進滑塊交互，支持點擊和按鈕控制

**設定項目：**
- **個性類型**：溫暖支持型、智慧導師型、溫和陪伴型、活力激勵型
- **語音類型**：溫暖親切、專業穩重、溫柔細膩、鼓勵積極
- **特性調整**：同理心、直接性、幽默感、正式程度 (1-10級)
- **AI模型**：標準模式、進階模式、同理模式
- **高級功能**：主動支持、智能建議、學習模式、語音對話、危機檢測

### 3. 聊天功能整合

**首頁聊天 (`app/(tabs)/index.tsx`)：**
- 使用個性化系統提示詞替換固定提示詞
- 根據用戶設定動態調整AI回應風格
- 保持與百煉API的完整整合

**獨立聊天頁面 (`app/chat.tsx`)：**
- 同樣整合AI設定上下文
- 在控制台輸出個性化提示詞供調試

## 🔧 系統提示詞生成邏輯

系統會根據用戶設定自動生成個性化的提示詞：

```typescript
// 示例生成的系統提示詞
你是 Dolphin，溫暖支持型的AI心理健康伴侶，像朋友般溫暖，提供情感支持和安慰。
用溫暖親切的語調，如摯友般親切地與用戶交流。

你的特性設定：
- 同理心程度：8/10 (高度同理，深度理解情感)
- 直接程度：6/10 (適度直接，溫和表達)
- 幽默感：4/10 (偶爾輕鬆對話)
- 正式程度：5/10 (友善但專業的語調)

提供深度的心理分析和專業建議，展現更強的理解力。
- 主動關懷：積極察覺用戶的情緒變化，主動提供支持和建議。
- 危機識別：密切注意用戶的心理危機信號，必要時提供緊急資源和建議。
- 智能建議：根據對話內容提供個性化的建議和練習方法。
- 學習模式：記住用戶的偏好和進展，持續優化交流方式。

請用繁體中文回復，保持溫暖、支持和專業的語調，提供有用的建議和情感支持。
```

## 🔄 完整使用流程

### 1. 用戶設定AI個性
1. 進入個人檔案 → AI設定
2. 選擇個性類型（如：智慧導師型）
3. 調整語音風格（如：專業穩重）
4. 微調特性參數（同理心：9/10，直接性：7/10）
5. 選擇AI模型（如：進階模式）
6. 開啟高級功能（主動支持、智能建議等）
7. 點擊保存

### 2. 系統處理設定
- AISettingsContext自動保存設定到AsyncStorage
- 生成對應的個性化系統提示詞
- 顯示保存成功確認

### 3. 對話中應用設定
- 用戶發送消息時，系統使用個性化提示詞
- AI回應體現用戶選擇的個性特點
- 不同設定產生明顯不同的對話風格

## 🎨 個性化效果示例

### 溫暖支持型 + 高同理心 (8/10)
```
"我能感受到你現在很累，這種感覺真的不好受。讓我們一起想想有什麼方式可以幫你放鬆一下，好嗎？你不是一個人在面對這些。"
```

### 智慧導師型 + 高直接性 (8/10)
```
"你提到的這個問題，我認為核心在於你對自己的期待過高。讓我們直接面對這個問題：什麼是你真正能控制的？"
```

### 活力激勵型 + 高幽默感 (7/10)
```
"哈哈，看起來你今天的能量條快見底了！沒關係，連超級英雄也需要充電時間。來，我們想個有趣的方式重新點燃你的小宇宙吧！"
```

## 🛠️ 技術實現要點

### 1. 狀態管理
- 使用React Context進行全局狀態管理
- AsyncStorage實現持久化存儲
- 自動同步設定變更

### 2. 用戶體驗
- 實時預覽設定效果
- 清晰的保存狀態反饋
- 防誤操作的重置確認

### 3. 擴展性設計
- 易於添加新的個性類型
- 支持更多AI模型選項
- 模塊化的提示詞生成邏輯

## 📱 使用說明

1. **首次使用**：系統會使用預設設定（溫暖支持型）
2. **個性化設定**：在AI設定頁面調整各項參數
3. **即時生效**：保存後的下一次對話即使用新設定
4. **重置選項**：可隨時恢復預設設定

## 🔍 調試功能

- 控制台會輸出生成的系統提示詞
- 設定變更會記錄到日誌
- 錯誤處理包含詳細的錯誤信息

這個系統提供了完整的AI個性化體驗，讓每個用戶都能擁有專屬的心理健康AI伴侶。
